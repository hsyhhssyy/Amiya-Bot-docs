import{_ as s,o as a,c as n,V as l}from"./chunks/framework.fcd1db8a.js";const A=JSON.parse('{"title":"QQ 群机器人 Beta","description":"","frontmatter":{},"headers":[],"relativePath":"develop/adapters/qqGroup.md","filePath":"develop/adapters/qqGroup.md","lastUpdated":1705484369000}'),p={name:"develop/adapters/qqGroup.md"},o=l(`<h1 id="qq-群机器人-beta" tabindex="-1">QQ 群机器人 <span class="beta-tag">Beta</span> <a class="header-anchor" href="#qq-群机器人-beta" aria-label="Permalink to &quot;QQ 群机器人 &lt;span class=&quot;beta-tag&quot;&gt;Beta&lt;/span&gt;&quot;">​</a></h1><p>在 <a href="https://bot.q.qq.com/wiki/#_2-%E4%BC%81%E4%B8%9A%E4%B8%BB%E4%BD%93%E5%85%A5%E9%A9%BB" target="_blank" rel="noreferrer">QQ 开放平台</a> 完成企业主体入驻，即可创建可在 QQ 群聊里使用的 QQ 群机器人。</p><h2 id="在公网下使用" tabindex="-1">在公网下使用 <a class="header-anchor" href="#在公网下使用" aria-label="Permalink to &quot;在公网下使用&quot;">​</a></h2><p>QQ 群聊适配器需要在本地启动资源服务让腾讯端能够访问媒体资源，默认在公网下使用。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">tencent</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">qqGroup </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> qq_group</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">client_secret </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 密钥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">appid</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">qq_group</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">client_secret</span><span style="color:#89DDFF;">))</span></span></code></pre></div><ul><li>在机器人启动时，资源服务也会一同启动。</li><li>默认的资源服务是端口单例的，实例化多个 QQ 群聊适配器 AmiyaBot 或使用 <a href="/develop/basic/multipleAccounts.html">多账号</a> 时，同一个端口的资源服务会相互共享。</li></ul><h3 id="修改资源服务配置" tabindex="-1">修改资源服务配置 <a class="header-anchor" href="#修改资源服务配置" aria-label="Permalink to &quot;修改资源服务配置&quot;">​</a></h3><p>引入 <code>QQGroupChainBuilderOptions</code> 修改默认的资源服务配置。</p><table><thead><tr><th>参数名</th><th>类型</th><th>释义</th><th>默认值</th></tr></thead><tbody><tr><td>host</td><td>str</td><td>资源服务监听地址</td><td>0.0.0.0</td></tr><tr><td>port</td><td>int</td><td>资源服务监听端口</td><td>8086</td></tr><tr><td>resource_path</td><td>str</td><td>临时文件存放目录</td><td>./resource</td></tr><tr><td>http_server_options</td><td>dict</td><td><a href="/develop/advanced/httpSupport.html">HttpServer **kwargs</a></td><td></td></tr></tbody></table><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">tencent</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">qqGroup </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> qq_group</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">adapters</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">tencent</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">qqGroup</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">builder </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> QQGroupChainBuilderOptions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#BABED8;font-style:italic;">appid</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#BABED8;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">qq_group</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#BABED8;font-style:italic;">client_secret</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">******</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#BABED8;font-style:italic;">default_chain_builder_options</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">QQGroupChainBuilderOptions</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0.0.0.0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#F78C6C;">8086</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./resource</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="自定义资源服务" tabindex="-1">自定义资源服务 <a class="header-anchor" href="#自定义资源服务" aria-label="Permalink to &quot;自定义资源服务&quot;">​</a></h2><p>多数情况下我们推荐使用第三方托管服务来搭建资源服务，如 <a href="https://www.baidu.com/s?wd=%E8%85%BE%E8%AE%AF%E4%BA%91COS" target="_blank" rel="noreferrer">腾讯云COS</a> 或 <a href="https://www.baidu.com/s?wd=%E9%98%BF%E9%87%8C%E4%BA%91OSS" target="_blank" rel="noreferrer">阿里云OSS</a> 等。</p><p>通过自定义默认的 <code>ChainBuilder</code>，来实现上传文件到托管服务以及返回生成的 url。</p><p>普通 ChainBuilder 可参考 <a href="/develop/advanced/chainBuilder.html">进阶指南 - 介入媒体消息的构建过程</a> ，但在这里更推荐继承适配器中的 <code>QQGroupChainBuilder</code>。</p><h3 id="普通-chainbuilder" tabindex="-1">普通 ChainBuilder <a class="header-anchor" href="#普通-chainbuilder" aria-label="Permalink to &quot;普通 ChainBuilder&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> typing </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> Union</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> graiax </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> silkcoder</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> amiyabot </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> ChainBuilder</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MyBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ChainBuilder</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">classmethod</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">get_image</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">cls</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">image</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Union</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">bytes</span><span style="color:#89DDFF;">])</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;"> Union</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">bytes</span><span style="color:#89DDFF;">]:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 上传图片到第三方托管服务</span></span>
<span class="line"><span style="color:#BABED8;">        ...</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> url </span><span style="color:#676E95;font-style:italic;"># 返回访问资源的 URL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">classmethod</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">get_voice</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">cls</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">voice_file</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 上传语音文件到第三方托管服务，语音文件必须是 silk 格式</span></span>
<span class="line"><span style="color:#BABED8;">        voice</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">bytes</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> silkcoder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">async_encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">voice_file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">ios_adaptive</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#BABED8;">        ...</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> url </span><span style="color:#676E95;font-style:italic;"># 返回访问资源的 URL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">classmethod</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">get_video</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">cls</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">video_file</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># 上传视频文件到第三方托管服务</span></span>
<span class="line"><span style="color:#BABED8;">        ...</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> url </span><span style="color:#676E95;font-style:italic;"># 返回访问资源的 URL</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">bot </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">AmiyaBot</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">...</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">adapter</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">qq_group</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">default_chain_builder</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">MyBuilder</span><span style="color:#89DDFF;">()))</span></span></code></pre></div><h3 id="继承-qqgroupchainbuilder" tabindex="-1">继承 QQGroupChainBuilder <a class="header-anchor" href="#继承-qqgroupchainbuilder" aria-label="Permalink to &quot;继承 QQGroupChainBuilder&quot;">​</a></h3><p>🚧 文档编写中... 🚧</p>`,18),t=[o];function e(r,c,y,D,F,i){return a(),n("div",null,t)}const d=s(p,[["render",e]]);export{A as __pageData,d as default};
